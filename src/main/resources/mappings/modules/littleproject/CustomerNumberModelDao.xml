<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qdch.portal.littleproject.dao.CustomerNumberModelDao">
	<resultMap id="getCustomerNumberModelDao"
		type="com.qdch.portal.littleproject.entity.CustomerNumberModel">
		<result property="vday" column="vday" />
		<result property="jys" column="jys" />
		<result property="jysmc" column="jysmc" />
		<result property="jysinfo" column="jysinfo" />
		<result property="fvalue" column="fvalue" />
	</resultMap>
	<select id="getCustomerNumberModelDao" resultMap="getCustomerNumberModelDao">
		SELECT
		VDAY,'总量' JYS,'总量' JYSMC,'总量' JYSINFO,SUM(FVALUE) FVALUE FROM
		(SELECT
		TO_CHAR(HDP."PERIOD_DATE",'YYYYMMDD') VDAY,
		COALESCE(T.JYS,'0015') JYS,
		COALESCE(T.JYSMC,'青岛文化产权交易中心有限公司') JYSMC,
		COALESCE(T.JYSINFO,'青岛文化产权') JYSINFO,
		COALESCE(SUM(T.FVALUE),0) FVALUE
		FROM HUB_D_PERIOD HDP
		LEFT JOIN INSIGHT_USER_QTY T
		ON HDP."PERIOD_DATE" = TO_DATE(T.VDAY,'YYYYMMDD') AND T.JYS IN('0015')
		WHERE hdp."PERIOD_DATE" > (SELECT TO_DATE(MAX(vday),'YYYYMMDD')-
		interval'15 d' FROM INSIGHT_USER_QTY)
		AND hdp."PERIOD_DATE" &lt;= (SELECT TO_DATE(MAX(vday),'YYYYMMDD') FROM
		INSIGHT_USER_QTY)
		GROUP BY HDP."PERIOD_DATE",T.JYS,T.JYSMC,T.JYSINFO
		UNION ALL
		SELECT
		TO_CHAR(HDP."PERIOD_DATE",'YYYYMMDD') VDAY,
		HDTJ.JYS,
		HDTJ.JYSMC,
		HTJ.JYSINFO,
		(SELECT COUNT(HTK.CID) FROM HUB_TQS_KHXX HTK WHERE HTK.JYS = HDTJ.JYS AND
		TO_DATE(HTK.DJRQ,'YYYYMMDD') &lt;= HDP."PERIOD_DATE") FVALUE
		FROM HUB_D_PERIOD HDP
		CROSS JOIN HUB_DD_TQS_JYS HDTJ
		LEFT JOIN HUB_REF_JYSINFO HTJ
		ON HDTJ.JYS = HTJ.JYS
		WHERE HDTJ.JYSFL = '2'
		AND hdp."PERIOD_DATE" > (SELECT TO_DATE(MAX(DJRQ),'YYYYMMDD')-
		interval'15 d' FROM HUB_TQS_KHXX)
		AND hdp."PERIOD_DATE" &lt;= (SELECT TO_DATE(MAX(DJRQ),'YYYYMMDD') FROM
		HUB_TQS_KHXX)
		GROUP BY HDP."PERIOD_DATE",HDTJ.JYS,HDTJ.JYSMC,HTJ.JYSINFO) LS
		GROUP BY VDAY
		UNION ALL
		SELECT
		TO_CHAR(HDP."PERIOD_DATE",'YYYYMMDD') VDAY,
		COALESCE(T.JYS,'0015') JYS,
		COALESCE(T.JYSMC,'青岛文化产权交易中心有限公司') JYSMC,
		COALESCE(T.JYSINFO,'青岛文化产权') JYSINFO,
		COALESCE(SUM(T.FVALUE),0) FVALUE
		FROM HUB_D_PERIOD HDP
		LEFT JOIN INSIGHT_USER_QTY T
		ON HDP."PERIOD_DATE" = TO_DATE(T.VDAY,'YYYYMMDD') AND T.JYS IN('0015')
		WHERE hdp."PERIOD_DATE" > (SELECT TO_DATE(MAX(vday),'YYYYMMDD')-
		interval'15 d' FROM INSIGHT_USER_QTY)
		AND hdp."PERIOD_DATE" &lt;= (SELECT TO_DATE(MAX(vday),'YYYYMMDD') FROM
		INSIGHT_USER_QTY)
		GROUP BY HDP."PERIOD_DATE",T.JYS,T.JYSMC,T.JYSINFO
		UNION ALL
		SELECT
		TO_CHAR(HDP."PERIOD_DATE",'YYYYMMDD') VDAY,
		HDTJ.JYS,
		HDTJ.JYSMC,
		HTJ.JYSINFO,
		(SELECT COUNT(HTK.CID) FROM HUB_TQS_KHXX HTK WHERE HTK.JYS = HDTJ.JYS AND
		TO_DATE(HTK.DJRQ,'YYYYMMDD') &lt;= HDP."PERIOD_DATE") FVALUE
		FROM HUB_D_PERIOD HDP
		CROSS JOIN HUB_DD_TQS_JYS HDTJ
		LEFT JOIN HUB_REF_JYSINFO HTJ
		ON HDTJ.JYS = HTJ.JYS
		WHERE HDTJ.JYSFL = '2'
		AND hdp."PERIOD_DATE" > (SELECT TO_DATE(MAX(DJRQ),'YYYYMMDD')-
		interval'15 d' FROM HUB_TQS_KHXX)
		AND hdp."PERIOD_DATE" &lt;= (SELECT TO_DATE(MAX(DJRQ),'YYYYMMDD') FROM
		HUB_TQS_KHXX)
		GROUP BY HDP."PERIOD_DATE",HDTJ.JYS,HDTJ.JYSMC,HTJ.JYSINFO
		ORDER BY
		vday,jys
	</select>
	<select id="getCustomerNumberModelDao2" resultMap="getCustomerNumberModelDao">
		SELECT
		VDAY,'总量' JYS,'总量' JYSMC,'总量' JYSINFO,SUM(FVALUE) FVALUE FROM
		(SELECT
		TO_CHAR(hdp."PERIOD_DATE",'YYYYMMDD') VDAY,
		COALESCE(T.JYS,'0015') JYS,
		COALESCE(T.JYSMC,'青岛文化产权交易中心有限公司') JYSMC,
		COALESCE(T.JYSINFO,'青岛文化产权')
		JYSINFO,
		COALESCE(SUM(T.FVALUE),0) FVALUE
		FROM HUB_D_PERIOD HDP
		LEFT JOIN
		INSIGHT_USER_QTY T
		ON HDP."PERIOD_DATE" = TO_DATE(T.VDAY,'YYYYMMDD')
		and T.jys IN ('0015')
		WHERE hdp."PERIOD_DATE" >= CURRENT_DATE -
		cast((TO_NUMBER(to_char(CURRENT_DATE,'D'),'99')) ||' days' as
		interval) - interval'76 day'
		AND hdp."PERIOD_DATE" &lt; CURRENT_DATE
		AND hdp."PERIOD_DATE" = hdp."PERIOD_DATE" -
		CAST(to_number(to_char(hdp."PERIOD_DATE",'d'),'9') - 1||' DAY' AS
		INTERVAL)
		GROUP BY hdp."PERIOD_DATE",T.JYS,T.JYSMC,T.JYSINFO
		UNION ALL
		SELECT
		TO_CHAR(hdp."PERIOD_DATE",'YYYYMMDD') VDAY,
		HDTJ.JYS,
		HDTJ.JYSMC,
		HTJ.JYSINFO,
		(SELECT COUNT(HTK.CID) FROM HUB_TQS_KHXX HTK WHERE HTK.JYS
		= HDTJ.JYS
		and
		to_date(HTK.djrq,'yyyymmdd') &lt;= hdp."PERIOD_DATE")
		FVALUE
		FROM HUB_D_PERIOD HDP
		CROSS JOIN HUB_DD_TQS_JYS HDTJ
		LEFT JOIN
		HUB_REF_JYSINFO HTJ
		ON HDTJ.JYS = HTJ.JYS
		WHERE HDTJ.JYSFL = '2'
		and
		hdp."PERIOD_DATE" >= CURRENT_DATE -
		cast((TO_NUMBER(to_char(CURRENT_DATE,'D'),'99')) ||' days' as
		interval) - interval'76 day'
		AND hdp."PERIOD_DATE" &lt; CURRENT_DATE
		AND hdp."PERIOD_DATE" = hdp."PERIOD_DATE" -
		CAST(to_number(to_char(hdp."PERIOD_DATE",'d'),'9') - 1||' DAY' AS
		INTERVAL)
		GROUP BY hdp."PERIOD_DATE",HDTJ.JYS,HDTJ.JYSMC,HTJ.JYSINFO)
		LS
		GROUP BY VDAY
		UNION ALL
		SELECT
		TO_CHAR(hdp."PERIOD_DATE",'YYYYMMDD')
		VDAY,
		COALESCE(T.JYS,'0015') JYS,
		COALESCE(T.JYSMC,'青岛文化产权交易中心有限公司')
		JYSMC,
		COALESCE(T.JYSINFO,'青岛文化产权') JYSINFO,
		COALESCE(SUM(T.FVALUE),0)
		FVALUE
		FROM HUB_D_PERIOD HDP
		LEFT JOIN INSIGHT_USER_QTY T
		ON
		HDP."PERIOD_DATE" = TO_DATE(T.VDAY,'YYYYMMDD') and T.jys IN ('0015')
		WHERE hdp."PERIOD_DATE" >= CURRENT_DATE -
		cast((TO_NUMBER(to_char(CURRENT_DATE,'D'),'99')) ||' days' as
		interval) - interval'76 day'
		AND hdp."PERIOD_DATE" &lt; CURRENT_DATE
		AND hdp."PERIOD_DATE" = hdp."PERIOD_DATE" -
		CAST(to_number(to_char(hdp."PERIOD_DATE",'d'),'9') - 1||' DAY' AS
		INTERVAL)
		GROUP BY hdp."PERIOD_DATE",T.JYS,T.JYSMC,T.JYSINFO
		UNION ALL
		SELECT
		TO_CHAR(hdp."PERIOD_DATE",'YYYYMMDD') VDAY,
		HDTJ.JYS,
		HDTJ.JYSMC,
		HTJ.JYSINFO,
		(SELECT COUNT(HTK.CID) FROM HUB_TQS_KHXX HTK WHERE HTK.JYS
		= HDTJ.JYS
		and
		to_date(HTK.djrq,'yyyymmdd') &lt;= hdp."PERIOD_DATE")
		FVALUE
		FROM HUB_D_PERIOD HDP
		CROSS JOIN HUB_DD_TQS_JYS HDTJ
		LEFT JOIN
		HUB_REF_JYSINFO HTJ
		ON HDTJ.JYS = HTJ.JYS
		WHERE HDTJ.JYSFL = '2'
		and
		hdp."PERIOD_DATE" >= CURRENT_DATE -
		cast((TO_NUMBER(to_char(CURRENT_DATE,'D'),'99')) ||' days' as
		interval) - interval'76 day'
		AND hdp."PERIOD_DATE" &lt; CURRENT_DATE
		AND hdp."PERIOD_DATE" = hdp."PERIOD_DATE" -
		CAST(to_number(to_char(hdp."PERIOD_DATE",'d'),'9') - 1||' DAY' AS
		INTERVAL)
		GROUP BY hdp."PERIOD_DATE",HDTJ.JYS,HDTJ.JYSMC,HTJ.JYSINFO
		ORDER BY
		vday,jys
	</select>
	<select id="getCustomerNumberModelDao3" resultMap="getCustomerNumberModelDao">
		SELECT
		VDAY,'总量' JYS,'总量' JYSMC,'总量' JYSINFO,SUM(FVALUE) FVALUE FROM
		(SELECT
		TO_CHAR(HDP."PERIOD_DATE",'YYYYMMDD') VDAY,
		COALESCE(T.JYS,'0015') JYS,
		COALESCE(T.JYSMC,'青岛文化产权交易中心有限公司') JYSMC,
		COALESCE(T.JYSINFO,'青岛文化产权')
		JYSINFO,
		coalesce(SUM(T.FVALUE),0) FVALUE
		FROM HUB_D_PERIOD HDP
		LEFT JOIN
		INSIGHT_USER_QTY T
		ON HDP."PERIOD_DATE" = TO_DATE(T.VDAY,'YYYYMMDD')
		and T.jys IN ('0015')
		WHERE HDP."PERIOD_DATE" > CURRENT_DATE -
		INTERVAL'1 YEAR' AND
		HDP."PERIOD_DATE" &lt;= CURRENT_DATE
		AND
		HDP."PERIOD_DATE" = TO_DATE(TO_CHAR(HDP."PERIOD_DATE" + INTERVAL'1
		MONTH','YYYYMM')||'01','YYYYMMDD') - INTERVAL'1 DAY'
		GROUP BY
		HDP."PERIOD_DATE",T.JYS,T.JYSMC,T.JYSINFO
		UNION ALL
		SELECT
		TO_CHAR(hdp."PERIOD_DATE",'YYYYMMDD') VDAY,
		HDTJ.JYS,
		HDTJ.JYSMC,
		HTJ.JYSINFO,
		(SELECT COUNT(HTK.CID) FROM HUB_TQS_KHXX HTK WHERE HTK.JYS
		= HDTJ.JYS
		and
		to_date(HTK.djrq,'yyyymmdd') &lt;= HDP."PERIOD_DATE")
		FVALUE
		FROM HUB_D_PERIOD HDP
		CROSS JOIN HUB_DD_TQS_JYS HDTJ
		LEFT JOIN
		HUB_REF_JYSINFO HTJ
		ON HDTJ.JYS = HTJ.JYS
		WHERE HDTJ.JYSFL = '2'
		AND
		HDP."PERIOD_DATE" > CURRENT_DATE - INTERVAL'1 YEAR'
		AND
		HDP."PERIOD_DATE" &lt;= CURRENT_DATE
		AND HDP."PERIOD_DATE" =
		TO_DATE(TO_CHAR(HDP."PERIOD_DATE" + INTERVAL'1
		MONTH','YYYYMM')||'01','YYYYMMDD') - INTERVAL'1 DAY'
		GROUP BY
		hdp."PERIOD_DATE",HDTJ.JYS,HDTJ.JYSMC,HTJ.JYSINFO) LS
		GROUP BY VDAY
		UNION ALL
		SELECT
		TO_CHAR(HDP."PERIOD_DATE",'YYYYMMDD') VDAY,
		COALESCE(T.JYS,'0015') JYS,
		COALESCE(T.JYSMC,'青岛文化产权交易中心有限公司') JYSMC,
		COALESCE(T.JYSINFO,'青岛文化产权') JYSINFO,
		coalesce(SUM(T.FVALUE),0) FVALUE
		FROM HUB_D_PERIOD HDP
		LEFT JOIN INSIGHT_USER_QTY T
		ON HDP."PERIOD_DATE"
		= TO_DATE(T.VDAY,'YYYYMMDD') and T.jys IN ('0015')
		WHERE
		HDP."PERIOD_DATE" > CURRENT_DATE - INTERVAL'1 YEAR' AND
		HDP."PERIOD_DATE" &lt;= CURRENT_DATE
		AND HDP."PERIOD_DATE" =
		TO_DATE(TO_CHAR(HDP."PERIOD_DATE" + INTERVAL'1
		MONTH','YYYYMM')||'01','YYYYMMDD') - INTERVAL'1 DAY'
		GROUP BY
		HDP."PERIOD_DATE",T.JYS,T.JYSMC,T.JYSINFO
		UNION ALL
		SELECT
		TO_CHAR(hdp."PERIOD_DATE",'YYYYMMDD') VDAY,
		HDTJ.JYS,
		HDTJ.JYSMC,
		HTJ.JYSINFO,
		(SELECT COUNT(HTK.CID) FROM HUB_TQS_KHXX HTK WHERE HTK.JYS
		= HDTJ.JYS
		and
		to_date(HTK.djrq,'yyyymmdd') &lt;= HDP."PERIOD_DATE")
		FVALUE
		FROM HUB_D_PERIOD HDP
		CROSS JOIN HUB_DD_TQS_JYS HDTJ
		LEFT JOIN
		HUB_REF_JYSINFO HTJ
		ON HDTJ.JYS = HTJ.JYS
		WHERE HDTJ.JYSFL = '2'
		AND
		HDP."PERIOD_DATE" > CURRENT_DATE - INTERVAL'1 YEAR'
		AND
		HDP."PERIOD_DATE" &lt;= CURRENT_DATE
		AND HDP."PERIOD_DATE" =
		TO_DATE(TO_CHAR(HDP."PERIOD_DATE" + INTERVAL'1
		MONTH','YYYYMM')||'01','YYYYMMDD') - INTERVAL'1 DAY'
		GROUP BY
		hdp."PERIOD_DATE",HDTJ.JYS,HDTJ.JYSMC,HTJ.JYSINFO ORDER BY
		vday,jys

	</select>
</mapper>