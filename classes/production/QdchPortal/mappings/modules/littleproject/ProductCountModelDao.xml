<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qdch.portal.littleproject.dao.ProductCountModelDao">
	<resultMap id="dtoResult"
		type="com.qdch.portal.littleproject.entity.ProductCountModel">
		<result property="cplb" column="cplb" />
		<result property="pjll" column="pjll" />
		<result property="jsyzz" column="jsyzz" />

	</resultMap>
	<select id="getProductCountModelDao" resultMap="dtoResult">
		SELECT
		HQC1.CPLB,
		COALESCE(ROUND((SELECT AVG(IYR.FVALUE) FROM INSIGHT_YIELD_RATE IYR
		LEFT JOIN HUB_QY_CPLB HQC2
		ON HQC2.CPDM = IYR.CPBM
		WHERE HQC1.CPLB = HQC2.CPLB AND
		TO_DATE(VDAY,'YYYYMMDD') &lt;= CURRENT_DATE
		AND TO_DATE(VDAY,'YYYYMMDD') >
		CURRENT_DATE - CAST(DATE_PART('DAY',CURRENT_DATE) - 1||' DAY' AS
		INTERVAL)),4),0) PJLL,

		COALESCE(ROUND(((SELECT AVG(IYR.FVALUE) FROM INSIGHT_YIELD_RATE IYR
		LEFT JOIN HUB_QY_CPLB HQC2
		ON HQC2.CPDM = IYR.CPBM
		WHERE HQC1.CPLB = HQC2.CPLB AND
		TO_DATE(VDAY,'YYYYMMDD') &lt;= CURRENT_DATE
		AND TO_DATE(VDAY,'YYYYMMDD') >
		CURRENT_DATE - CAST(DATE_PART('DAY',CURRENT_DATE) - 1||' DAY' AS
		INTERVAL)) -
		(SELECT AVG(IYR.FVALUE) FROM INSIGHT_YIELD_RATE IYR
		LEFT JOIN HUB_QY_CPLB HQC2
		ON HQC2.CPDM = IYR.CPBM
		WHERE HQC1.CPLB = HQC2.CPLB AND
		TO_DATE(VDAY,'YYYYMMDD') >= CURRENT_DATE - INTERVAL'1 MONTH' -
		CAST(DATE_PART('DAY',CURRENT_DATE) - 1||' DAY' AS INTERVAL)
		AND
		TO_DATE(VDAY,'YYYYMMDD') &lt;= CURRENT_DATE -
		CAST(DATE_PART('DAY',CURRENT_DATE)||' DAY' AS INTERVAL))) /
		(SELECT AVG(IYR.FVALUE) FROM INSIGHT_YIELD_RATE IYR
		LEFT JOIN HUB_QY_CPLB HQC2
		ON HQC2.CPDM = IYR.CPBM
		WHERE HQC1.CPLB = HQC2.CPLB AND
		TO_DATE(VDAY,'YYYYMMDD') >= CURRENT_DATE - INTERVAL'1 MONTH' -
		CAST(DATE_PART('DAY',CURRENT_DATE) - 1||' DAY' AS INTERVAL)
		AND
		TO_DATE(VDAY,'YYYYMMDD') &lt;= CURRENT_DATE -
		CAST(DATE_PART('DAY',CURRENT_DATE)||' DAY' AS INTERVAL)),4),0) JSYZZ
		FROM HUB_QY_CPFL HQC1 ORDER BY cplb
	</select>
</mapper>